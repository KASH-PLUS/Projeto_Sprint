<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
	<title>Dashboard - KASH+</title>
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
	<link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
	<link rel="stylesheet" href="assets/css/styles.min.css">
</head>

<body id="page-top" onload="validarSessao(), listarCaixas(), verificarCargo()">
	<div id="wrapper">
		<nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0"
			style="background: rgb(0, 132, 156);">
			<div class="container-fluid d-flex flex-column p-0"><a
					class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
					<div class="sidebar-brand-icon"><img src="assets/img/logo/logoWhite.png" width="60%"
							style="margin-top: 10%;"></div>
				</a>
				<hr class="sidebar-divider my-0">
				<ul id="accordionSidebar" class="navbar-nav text-light">
					<li class="nav-item">
						<a class="nav-link" href="listarUser.html" id="link_list_user"><i
								class="fas fa-user"></i><span>Lista de
								usuários</span></a>

						<a class="nav-link" href="addUser.html" id="link_add_user"><i
								class="fas fa-user-plus"></i><span>Adicionar
								Usuário</span></a>

						<a class="nav-link" href="addCaixa.html" id="link_add_caixa"><i
								class="fas fa-server"></i><span>Cadastrar
								Caixa</span></a>
					</li>
					<li class="nav-item"><a class="nav-link active" data-bs-toggle="collapse" href="#div_caixas"
							role="button" aria-expanded="false" aria-controls="div_caixas" id="link_dash"><i
								class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
						<div class="collapse show" id="div_caixas">
						</div>
					</li>
				</ul>
				<div class="text-center d-none d-md-inline"><button class="btn rounded-circle border-0"
						id="sidebarToggle" type="button"></button></div>
			</div>
		</nav>
		<div class="d-flex flex-column" id="content-wrapper">
			<div id="content">
				<nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
					<div class="container-fluid">
						<h5 style="color: var(--bs-navbar-brand-color);">Administrador</h5>
						<ul class="navbar-nav flex-nowrap ms-auto">
							<li class="nav-item dropdown no-arrow mx-1"></li>
							<li class="nav-item dropdown no-arrow mx-1">
								<div class="shadow dropdown-list dropdown-menu dropdown-menu-end"
									aria-labelledby="alertsDropdown"></div>
							</li>
							<div class="d-none d-sm-block topbar-divider"></div>
							<li class="nav-item dropdown no-arrow">
								<div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link"
										aria-expanded="false" data-bs-toggle="dropdown" href="#"><span
											class="d-none d-lg-inline me-2 text-gray-600 small" id="span_user">Kash
											User</span><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
											viewBox="0 0 24 24" fill="none" style="font-size: 33px;">
											<path
												d="M5.12104 17.8037C7.15267 16.6554 9.4998 16 12 16C14.5002 16 16.8473 16.6554 18.879 17.8037M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10ZM21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
												stroke="currentColor" stroke-width="2" stroke-linecap="round"
												stroke-linejoin="round"></path>
										</svg></a>
									<div class="dropdown-menu shadow dropdown-menu-end animated--grow-in"><a
											class="dropdown-item" onclick="limparSessao()"><i
												class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Sair</a>
									</div>
								</div>
							</li>
						</ul>
					</div>
				</nav>
				<div class="container-fluid">
					<div class="d-sm-flex justify-content-between align-items-center mb-4">
						<h3 class="text-dark mb-0" id="h3_titulo">Dashboard</h3>
					</div>
					<div class="row">
						<div class="col-md-6 col-xl-3 mb-4">
							<div class="card shadow border-start-primary py-2">
								<div class="card-body">
									<div class="row align-items-center no-gutters">
										<div class="col me-2">
											<div class="text-uppercase text-primary fw-bold text-xs mb-1"><span>LOREM
													IPSUM</span></div>
											<div class="text-dark fw-bold h5 mb-0"><span>$40,000</span></div>
										</div>
										<div class="col-auto"><i class="fas fa-calendar fa-2x text-gray-300"></i></div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xl-3 mb-4">
							<div class="card shadow border-start-success py-2">
								<div class="card-body">
									<div class="row align-items-center no-gutters">
										<div class="col me-2">
											<div class="text-uppercase text-success fw-bold text-xs mb-1"><span>LOREM
													IPSUM</span></div>
											<div class="text-dark fw-bold h5 mb-0"><span>$215,000</span></div>
										</div>
										<div class="col-auto"><i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xl-3 mb-4">
							<div class="card shadow border-start-info py-2">
								<div class="card-body">
									<div class="row align-items-center no-gutters">
										<div class="col me-2">
											<div class="text-uppercase text-info fw-bold text-xs mb-1"><span>loREM
													IPSUM</span></div>
											<div class="row g-0 align-items-center">
												<div class="col-auto">
													<div class="text-dark fw-bold h5 mb-0 me-3"><span>50%</span></div>
												</div>
												<div class="col">
													<div class="progress progress-sm">
														<div class="progress-bar bg-info" aria-valuenow="50"
															aria-valuemin="0" aria-valuemax="100" style="width: 50%;">
															<span class="visually-hidden">50%</span>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="col-auto"><i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xl-3 mb-4">
							<div class="card shadow border-start-warning py-2">
								<div class="card-body">
									<div class="row align-items-center no-gutters">
										<div class="col me-2">
											<div class="text-uppercase text-warning fw-bold text-xs mb-1"><span>lorem
													ipsum</span></div>
											<div class="text-dark fw-bold h5 mb-0"><span>18</span></div>
										</div>
										<div class="col-auto"><i class="fas fa-comments fa-2x text-gray-300"></i></div>
									</div>
								</div>
							</div>
						</div>
						<div class="w-100"></div>
					</div>
					<div class="row">
						<div class="col-lg-7 col-xl-8">
							<div class="card shadow mb-4">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h6 class="text-primary fw-bold m-0">Uso da CPU</h6>
								</div>
								<div class="card-body">
									<div class="chart-area"
										style="display: flex; align-items: center; justify-content: center;">
										<div class="chart-container" id="grafico_cpu"
											style="position: relative; width: 45vw;">
											<canvas id="myChartCpu">
											</canvas>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-lg-5 col-xl-4">
							<div class="card shadow mb-4">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h6 class="text-primary fw-bold m-0">Uso de disco</h6>
								</div>
								<div class="card-body">
									<div class="chart-area"><canvas></canvas>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-lg-12 col-xl-12">
								<div class="card shadow mb-4">
									<div class="card-header d-flex justify-content-between align-items-center">
										<h6 class="text-primary fw-bold m-0">Uso de memória RAM</h6>
									</div>
									<div class="card-body">
										<div class="chart-area">
											<div class="chart-container" id="grafico_ram">
												<canvas id="myChartRam">
												</canvas>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<footer class="bg-white sticky-footer">
					<div class="container my-auto">
						<div class="text-center my-auto copyright"><span>Copyright © KASH+&nbsp;2022</span></div>
					</div>
				</footer>
			</div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
		</div>
		<script src="assets/bootstrap/js/bootstrap.min.js"></script>
		<script src="assets/js/script.min.js"></script>
		<script src="../js/funcoes.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>

</html>
<script>
	setTimeout(addListeners, 500);

	let proximaAtualizacao;

	function obterDadosGraficoCpu(serialNumber) {
		document.getElementById("myChartCpu").remove();

		var divGrafico = document.getElementById("grafico_cpu");
		var canvas = document.createElement("canvas");
		canvas.id = "myChartCpu";

		divGrafico.appendChild(canvas);

		if (proximaAtualizacao != undefined) {
			clearTimeout(proximaAtualizacao);
		}

		fetch(`/medidas/ultimasCpu/${serialNumber}`, { cache: 'no-store' }).then(function (response) {
			if (response.ok) {
				response.json().then(function (resposta) {
					console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
					resposta.reverse();

					plotarGraficoCpu(resposta, serialNumber);
				});
			} else {
				console.error('Nenhum dado encontrado ou erro na API');
			}
		})
			.catch(function (error) {
				console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
			});
	}

	function plotarGraficoCpu(resposta, serialNumber) {
		console.log('iniciando plotagem do gráfico...');
		console.log(serialNumber);

		let labels = [];

		var dados = {
			labels: labels,
			datasets: [
				{
					yAxisID: 'y-usoCpu',
					label: 'Uso da cpu',
					borderColor: '#00BFFF',
					backgroundColor: '#00BFFF',
					fill: true,
					data: [],
				},
			]
		};

		for (i = 0; i < resposta.length; i++) {
			var registro = resposta[i];
			labels.push(registro.momento_grafico);
			dados.datasets[0].data.push(registro.Registro);
		}

		console.log(JSON.stringify(dados));

		const config = {
			type: 'line',
			data: dados,
			responsive: true,
		};

		let myChartCpu = new Chart(
			document.getElementById('myChartCpu'),
			config
		);


		setTimeout(() => atualizarGraficoCpu(serialNumber, dados, myChartCpu), 2000);
	}

	function atualizarGraficoCpu(serialNumber, dados, myChartCpu) {

		fetch(`/medidas/tempo-realCpu/${serialNumber}`, { cache: 'no-store' }).then(function (response) {
			if (response.ok) {
				response.json().then(function (novoRegistro) {

					console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
					console.log(`Dados atuais do gráfico: ${dados}`);

					// tirando e colocando valores no gráfico
					dados.labels.shift(); // apagar o primeiro
					dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

					dados.datasets[0].data.shift();  // apagar o primeiro de umidade
					dados.datasets[0].data.push((novoRegistro[0].Registro)); // incluir uma nova medida de umidade

					// dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
					// dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

					myChartCpu.update();

					// Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
					proximaAtualizacao = setTimeout(() => atualizarGraficoCpu(serialNumber, dados, myChartCpu), 2000);
				});
			} else {
				console.error('Nenhum dado encontrado ou erro na API');
				// Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
				proximaAtualizacao = setTimeout(() => atualizarGraficoCpu(serialNumber, dados, myChartCpu), 2000);
			}
		})
			.catch(function (error) {
				console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
			});

	}


	function obterDadosGraficoRam(serialNumber) {
		document.getElementById("myChartRam").remove();

		var divGrafico = document.getElementById("grafico_ram");
		var canvas = document.createElement("canvas");
		canvas.id = "myChartRam";

		divGrafico.appendChild(canvas);

		if (proximaAtualizacao != undefined) {
			clearTimeout(proximaAtualizacao);
		}

		fetch(`/medidas/ultimasRam/${serialNumber}`, { cache: 'no-store' }).then(function (response) {
			if (response.ok) {
				response.json().then(function (resposta) {
					console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
					resposta.reverse();

					plotarGraficoRam(resposta, serialNumber);
				});
			} else {
				console.error('Nenhum dado encontrado ou erro na API');
			}
		})
			.catch(function (error) {
				console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
			});
	}

	function plotarGraficoRam(resposta, serialNumber) {
		console.log('iniciando plotagem do gráfico...');
		console.log(serialNumber);

		let labels = [];

		var dados = {
			labels: labels,
			datasets: [
				{
					yAxisID: 'y-usoRam',
					label: 'Uso da ram',
					borderColor: '#00BFFF',
					backgroundColor: '#00BFFF',
					fill: true,
					data: [],
				},
			],
			options:{
				maintainAspectRatio: false,
				responsive: true
			}
		};

		for (i = 0; i < resposta.length; i++) {
			var registro = resposta[i];
			labels.push(registro.momento_grafico);
			dados.datasets[0].data.push(registro.Registro);
		}

		console.log(JSON.stringify(dados));

		const configRam = {
			type: 'line',
			data: dados,
			// responsive: true,
			options:{
				maintainAspectRatio: false,
			}

		};

		let myChartRam = new Chart(
			document.getElementById('myChartRam'),
			configRam
		);


		setTimeout(() => atualizarGraficoRam(serialNumber, dados, myChartRam), 2000);
	}

	function atualizarGraficoRam(serialNumber, dados, myChartRam) {

		fetch(`/medidas/tempo-realRam/${serialNumber}`, { cache: 'no-store' }).then(function (response) {
			if (response.ok) {
				response.json().then(function (novoRegistro) {

					console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
					console.log(`Dados atuais do gráfico: ${dados}`);

					// tirando e colocando valores no gráfico
					dados.labels.shift(); // apagar o primeiro
					dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

					dados.datasets[0].data.shift();  // apagar o primeiro de umidade
					dados.datasets[0].data.push((novoRegistro[0].Registro)); // incluir uma nova medida de umidade

					// dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
					// dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

					myChartRam.update();

					// Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
					proximaAtualizacao = setTimeout(() => atualizarGraficoRam(serialNumber, dados, myChartRam), 2000);
				});
			} else {
				console.error('Nenhum dado encontrado ou erro na API');
				// Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
				proximaAtualizacao = setTimeout(() => atualizarGraficoRam(serialNumber, dados, myChartRam), 2000);
			}
		})
			.catch(function (error) {
				console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
			});

	}


</script>